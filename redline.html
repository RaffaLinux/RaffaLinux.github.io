<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - Projects</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
        }
        header {
            background-color: #333;
            color: white;
            padding: 1rem 0;
            text-align: center;
        }
        header h1 {
            margin: 0;
        }
        nav {
            background-color: #444;
            text-align: center;
            padding: 0.5rem 0;
        }
        nav a {
            color: white;
            text-decoration: none;
            margin: 0 1rem;
        }
        nav a:hover {
            text-decoration: underline;
        }
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        }
        .project {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        .project img {
            width: calc(100% + 2rem); /* Expands image to compensate for padding */
            height: auto;
            margin: -1rem -1rem 1rem -1rem; /* Negates padding for full width */
            border-radius: 8px 8px 0 0; /* Keeps top corners rounded */
        }
        .project h2 {
            margin: 0.5rem 0;
            font-size: 1rem;
        }
        .project p {
            font-size: 0.9rem;
            line-height: 1.4;
            margin: 0;
        }
        .project a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
            margin-top: 0.5rem;
            display: inline-block;
        }
        .project a:hover {
            text-decoration: underline;
        }
        .publication {
            background: white;
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        body {
            font-family: monospace;
            background-color: #1e1e1e;
            color: #ffffff;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            border: 2px solid #888;
        }
        th, td {
            border: 1px solid #888;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #444;
        }
        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .publication h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        .publication p {
            margin: 0.5rem 0 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .contacts {
            text-align: center;
            margin-top: 1rem;
            padding: 0.2rem;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        .contacts p {
            margin: 0.5rem 0;
            font-size: 1rem;
        }
        .contacts a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }
        .contacts a:hover {
            text-decoration: underline;
        }
        footer {
            text-align: center;
            padding: 1rem 0;
            background-color: #333;
            color: white;
        }
        .gallery-item {
                width: 300px;
                height: auto;
            cursor: pointer;
        }
        footer a {
            color: #007bff;
        }
        @media (max-width: 768px) {
            .project img {
                height: auto;
            }
        }
    </style>
                
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        const galleryItems = document.querySelectorAll('.gallery-item');
                        galleryItems.forEach(item => {
                            // Wrap each image in a container
                            const container = document.createElement('div');
                            container.style.position = 'relative';
                            container.style.display = 'inline-block';
                            container.style.margin = '10px';
                            
                            // Create zoom icon
                            const zoomIcon = document.createElement('i');
                            zoomIcon.className = 'fas fa-search-plus';
                            zoomIcon.style.position = 'absolute';
                            zoomIcon.style.top = '10px';
                            zoomIcon.style.right = '10px';
                            zoomIcon.style.color = 'white';
                            zoomIcon.style.fontSize = '20px';
                            zoomIcon.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
                            zoomIcon.style.borderRadius = '50%';
                            zoomIcon.style.padding = '5px';
                            
                            // Append image and zoom icon to container
                            container.appendChild(item.cloneNode());
                            container.appendChild(zoomIcon);
                            item.parentNode.replaceChild(container, item);
                            
                            container.addEventListener('click', function() {
                                const modal = document.createElement('div');
                                modal.style.position = 'fixed';
                                modal.style.top = '0';
                                modal.style.left = '0';
                                modal.style.width = '100%';
                                modal.style.height = '100%';
                                modal.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
                                modal.style.display = 'flex';
                                modal.style.alignItems = 'center';
                                modal.style.justifyContent = 'center';
                                modal.style.zIndex = '1000';
                                
                                const img = document.createElement('img');
                                img.src = container.querySelector('img').src;
                                img.style.maxWidth = '90%';
                                img.style.maxHeight = '90%';
                                img.style.border = '2px solid white';
                                
                                modal.appendChild(img);
                                document.body.appendChild(modal);
                                
                                modal.addEventListener('click', function() {
                                    document.body.removeChild(modal);
                    });
                    });
                });
                });
            </script>
</head>
<body>
    <header>
        <h1>Raffaele Carillo's Portfolio</h1>
    </header>
    
    <nav>
        <a href="./index.html">Home</a>
        <a href="./index.html#about">Who am I?</a>
        <a href="./index.html#projects">Projects</a>
        <a href="./index.html#publications">Publications</a>
        <a href="./index.html#contact">Contacts</a>
    </nav>

    <div class="container">
        <h1>Redline Infostealer Analysis</h1>
        <h2>Introduction</h2>
        <p><b>DISCLAIMER: while this is a malware analysis it is not to be confused with a full reverse engineering of the code as it is beyond the objective of building IoCs and malware behavioural and static signatures.</b></p>
        <p>Redline is a malware family that has been active since 2012. It is a data stealer that is capable of exfiltrating sensitive information from the victim's machine. The malware is written in C++ and is often packed with a custom packer and loaded on the victim's machine through various loading and defense evasion mechanisms. The malware is capable of stealing sensitive information such as credentials, cookies, and browser history. The malware is also capable of taking screenshots of the victim's machine.</p>
        <h2>First stage: Downloader</h2>
        <h3>Basic static analysis</h3>
        <p>The sample under analysis (<b>SHA1:d6ae1c5d0bf5d7784c775ee833ec63756c77bdae</b>) is flagged as a generic Trojan Downloader by most AV suites or as Fareit by some of them. It is a EXE file built for x86-64 Windows systems.
        We first analyze its capabilities using capa. The output of the tool is shown below:</p>

        <div id="" style="overflow:scroll; height:400px;">
            <div class="section-title">File Information</div>
            <table>
                <tbody>
                    <tr><th>md5</th><td>ae81456496d974ac77aa11fcd2de8b0f</td></tr>
                    <tr><th>sha1</th><td>d6ae1c5d0bf5d7784c775ee833ec63756c77bdae</td></tr>
                    <tr><th>sha256</th><td>81be001c01d1fae33deab1c542661e90f07be5ae168f8220415063d26cd578ca</td></tr>
                    <tr><th>analysis</th><td>static</td></tr>
                    <tr><th>os</th><td>windows</td></tr>
                    <tr><th>format</th><td>pe</td></tr>
                    <tr><th>arch</th><td>amd64</td></tr>
                    <tr><th>path</th><td>C:/Users/User/Downloads/81be001c01d1fae33deab1c542661e90f07be5ae168f8220415063d26cd578ca.exe</td></tr>
                </tbody>
            </table>
        
            <div class="section-title">ATT&CK Mapping</div>
            <table>
                <thead>
                    <tr><th>ATT&CK Tactic</th><th>ATT&CK Technique</th></tr>
                </thead>
                <tbody>
                    <tr><td>DEFENSE EVASION</td><td>Obfuscated Files or Information::Indicator Removal from Tools [T1027.005]</td></tr>
                    <tr><td>DISCOVERY</td><td>System Information Discovery [T1082]</td></tr>
                    <tr><td>EXECUTION</td><td>Shared Modules [T1129]</td></tr>
                    <tr><td>PERSISTENCE</td><td>Boot or Logon Autostart Execution::Registry Run Keys / Startup Folder [T1547.001]</td></tr>
                </tbody>
            </table>
        
            <div class="section-title">MBC Mapping</div>
            <table>
                <thead>
                    <tr><th>MBC Objective</th><th>MBC Behavior</th></tr>
                </thead>
                <tbody>
                    <tr><td>ANTI-STATIC ANALYSIS</td><td>Executable Code Obfuscation::Argument Obfuscation [B0032.020]</td></tr>
                    <tr><td></td><td>Executable Code Obfuscation::Stack Strings [B0032.017]</td></tr>
                    <tr><td>COMMUNICATION</td><td>HTTP Communication [C0002]</td></tr>
                    <tr><td></td><td>HTTP Communication::Read Header [C0002.014]</td></tr>
                    <tr><td>DISCOVERY</td><td>Analysis Tool Discovery::Process detection [B0013.001]</td></tr>
                    <tr><td></td><td>Code Discovery::Enumerate PE Sections [B0046.001]</td></tr>
                    <tr><td></td><td>System Information Discovery [E1082]</td></tr>
                    <tr><td>PERSISTENCE</td><td>Registry Run Keys / Startup Folder [F0012]</td></tr>
                </tbody>
            </table>
        
            <div class="section-title">Capabilities</div>
            <table>
                <thead>
                    <tr><th>Capability</th><th>Namespace</th></tr>
                </thead>
                <tbody>
                    <tr><td>reference analysis tools strings</td><td>anti-analysis</td></tr>
                    <tr><td>contain obfuscated stackstrings</td><td>anti-analysis/obfuscation/string/stackstring</td></tr>
                    <tr><td>reference HTTP User-Agent string</td><td>communication/http</td></tr>
                    <tr><td>check HTTP status code</td><td>communication/http/client</td></tr>
                    <tr><td>check OS version</td><td>host-interaction/os/version</td></tr>
                    <tr><td>link function at runtime on Windows</td><td>linking/runtime-linking</td></tr>
                    <tr><td>enumerate PE sections (2 matches)</td><td>load-code/pe</td></tr>
                    <tr><td>resolve function by parsing PE exports (2 matches)</td><td>load-code/pe</td></tr>
                    <tr><td>persist via Run registry key</td><td>persistence/registry/run</td></tr>
                </tbody>
            </table>
            </div>
            
            <p>We can see that it has some basic capabilities such as comunicate with a HTTP server as well as to establish persistence using the Registry run key as well to detect processes for Anti-Analysis purposes.</p>
            <p>Next, we will analyze the strings of the sample using DetectItEasy. The output of the tool is shown below:</p>
            
            <img src="./redlineAnalysis/strings1.png" alt="Redline strings analysis" class="gallery-item">
            <p>We can see that the sample contains strings relative to the aforementioned techniques, such as an URL for the C2 server  to a dll named "<b>bot.dll</b>" (SHA1: 78bdad1cf98759ec9dbcc1888cdaa2f7fccfcdbc). Its IP - "<b>176.113.115.149</b>" - refers to a server loacted in Russia. The process names of famous analysis tools such as <b>x64dbg</b> and <b>Process Hacker</b> are also present, presumably to evade analysis. It also makes use the registry run key to achieve persistence. Additionally, it mentions <b>explorer.exe</b> probably to achieve process injection. Finally, the use of reflection to load the malware is also probably exploited.</p>
            <p>The PE of the executable contains six sections beside the Header and the entropy measurement indicates that none of them are packed. The sample was compiled with Microsoft Visual C/C++ (17.00.50727) [C++], linked with Microsoft Linker (11.00.50727) and written using Visual Studio 2012.</p>
        <h3>Basic dynamic analysis</h3>
        <p>Next, we analyze the sample by running it in a controlled environment. We use <b>Process Monitor</b> to monitor the file system, registry, and, with also <b>Wireshark</b>, network activity of the sample. To analyse the sample, it's anti-analysis functions were patched so to not detect the analysis tools. The output of the tool is shown below:</p>
            <img src="./redlineAnalysis/botDownloadWireshark.png" alt="Redline strings analysis" class="gallery-item">
            <img src="./redlineAnalysis/procmondownloader1.png" alt="Redline strings analysis" class="gallery-item">
            <img src="./redlineAnalysis/procmondownloader2.png" alt="Redline strings analysis" class="gallery-item">


        <p>After this, the malware relaunches itself as "<b>msiexec.exe</b>" after setting environment variables. Also it downloads a .exe file with a temp name to %AppData%.</p> 
        <p>Then a whole suite of malicious executables are downloaded and executed on the system. In particular the following .exe are downloaded</p>
        <li>nvc.exe - SHA1: 40d5d83a04d33347431128338490615d4390088c</li>
        <li>svc.exe - SHA1: d0639a290e178e152e50b50c185d08f79ab52629</li>
        <li>z.exe - SHA1: bf9339f46d7a33d342aeb7fca8b5d5fb8b4d165a</li>
        <li>zx.exe - SHA1: 8e0b84d2d362126d157ad9e50d295a18427af8e0</li>
        <li>update.exe - SHA1: bf9339f46d7a33d342aeb7fca8b5d5fb8b4d165a</li>
        <img src="./redlineAnalysis/malwareDownloadsWireshark.png" alt="Redline strings analysis" class="gallery-item">

        <p>While an in depth analysis for each of these files was not carried, it can be said that each has a set of exported functions or internal routines that aim to steal data in different ways, including scanning user folders, capturing screenshots, injecting web pages, and stealing cookie. Each of these executables has capabilities to send data to the C2 server independently. <br> We observe evidence of that in the Procmon logs, which indicates that one of these samples collected screenshots and builded in its install path - %ProgramData% - a set of folders regarding famous programs of various categories (including FTP clients, and Messaging apps) and then packed the logs to a .zip file and then uploaded it.</p>
        <img src="./redlineAnalysis/malwareDownload (8).png" alt="Redline strings analysis" class="gallery-item">
        <img src="./redlineAnalysis/malwareDownload (9).png" alt="Redline strings analysis" class="gallery-item">

        <h3>Advanced static analysis</h3>
        <p>Next, we analyze the sample using <b>IDA Pro</b>. For convinience, we shall rename all crucial functions and variables once their role in the execution has been determined. The malware exports the usual <b>start</b> function.</p>
        <p>The first called function dynamically imports a long list of functions from various system lybraries and creates a referene to them. The most effective way to reverse engineer this program is to rename those functions thus making it clearer their purposes throughout the program. By doing this properly the analysis tool is also helped in its task of identifying common function signatures. In this function, also three registry keys are present that refer to startup programs.</p>
        <p>The malware also checks for the presence of debuggers and exits in that case.</p>
        <img src="./redlineAnalysis/ImportFunctions.png" alt="Redline strings analysis" class="gallery-item">
        <img src="./redlineAnalysis/CheckDebugging.png" alt="Redline strings analysis" class="gallery-item">

        <p>After enabling all the privileges for itself, the malware proceeds with the download of the malicious DLL. In particular, it downloads the malicious DLL from one of the C2 IPs to its process heap and then injects the explorer process with it.</p>
        <img src="./redlineAnalysis/DownloadToHeap.png" alt="Redline strings analysis" class="gallery-item">
        <img src="./redlineAnalysis/DownloadAndInjectExplorer.png" alt="Redline strings analysis" class="gallery-item">
        <img src="./redlineAnalysis/InjectExplorer.png" alt="Redline strings analysis" class="gallery-item">

        <p>After the injection, the malware checks if it has been launched as "msiexec.exe", if so it checks if the mutex "worker_VznLpbPuTg" is set, if it isn't it exits the process. It is worth to point that the use of the mutex isn't to make sure that only one instance of the malware is running, but rather it is probably used to check for the presence of other pieces of software. After that, it creates a thread that creates an exe file by using the (hashed) volume serial number and, checks for the presence of analysis software like Process Hacker and x64dbg, adds the .exe to an autorun key ("Software\\Microsoft\\Windows\\CurrentVersion\\Run") for future execution and sleeps the process if analysis softwares are found. Meanwhile, another thread attempts to download and inject the DLL again, this time with the "Diamotrixes" mutex</p>
        <img src="./redlineAnalysis/GetHashedVolumeInfo.png" alt="Redline strings analysis" class="gallery-item">
        <img src="./redlineAnalysis/SleepIfAnalyzed.png" alt="Redline strings analysis" class="gallery-item">

        <p>If the malware has a different name, it will move its file similarly to how mentioned before.</p>
        <p>Then, it checks if the operating system version is Windows 7 or earlier. If a mutex "GqgWzd" isn't set it exits the process. </p>
        <p>Finally, it sets a series of environment variables (msiexec.exe, audiodg.exe, svchost.exe) to point to the current path of the malware module. Then it uses process hollowing to launch one (the first successfully set) executable pointed by the environment variables and uses ntdll to perform process hollowing by using "NtUnmapViewOfSection","ZwQueryVirtualMemory", and "WriteProcessMemory"</p>
        <img src="./redlineAnalysis/SetEnvVars.png" alt="Redline strings analysis" class="gallery-item">
        <img src="./redlineAnalysis/hollowing (1).png" alt="Redline strings analysis" class="gallery-item">
        <img src="./redlineAnalysis/hollowing (2).png" alt="Redline strings analysis" class="gallery-item">
        <p>This marks the last function of the malware downloader which then exits. </p>

        <h2>Second stage: Bot</h2>

        The downlaoder downloads a DLL file named "<b>bot.dll</b>" (SHA1: 78bdad1cf98759ec9dbcc1888cdaa2f7fccfcdbc). Again, we analyze its general capabilities using capa.

        <div id="" style="overflow:scroll; height:400px;">
            <div class="section-title">File Information</div>
            <table>
                <tbody>
                    <tr><th>md5</th><td>245749553e7194636b0f78e7dea115ef</td></tr>
                    <tr><th>sha1</th><td>78bdad1cf98759ec9dbcc1888cdaa2f7fccfcdbc</td></tr>
                    <tr><th>sha256</th><td>4b7e4232fec31a80cdccada106516e45a38d97ae18fbba586d4bec41c0bad823</td></tr>
                    <tr><th>analysis</th><td>static</td></tr>
                    <tr><th>os</th><td>windows</td></tr>
                    <tr><th>format</th><td>pe</td></tr>
                    <tr><th>arch</th><td>amd64</td></tr>
                    <tr><th>path</th><td>C:/Users/User/Downloads/bot.dll</td></tr>
                </tbody>
            </table>
        
            <div class="section-title">ATT&CK Mapping</div>
            <table>
                <thead>
                    <tr><th>ATT&CK Tactic</th><th>ATT&CK Technique</th></tr>
                </thead>
                <tbody>
                    <tr><td>COLLECTION</td><td>Archive Collected Data::Archive via Library [T1560.002]</td></tr>
                    <tr><td rowspan="6">DEFENSE EVASION</td><td>File and Directory Permissions Modification [T1222]</td></tr>
                    <tr><td>Obfuscated Files or Information [T1027]</td></tr>
                    <tr><td>Obfuscated Files or Information::Indicator Removal from Tools  [T1027.005]</td></tr>
                    <tr><td>Process Injection::Process Hollowing [T1055.012]</td></tr>
                    <tr><td> Process Injection::Thread Execution Hijacking [T1055.003]</td></tr>
                    <tr><td>Reflective Code Loading [T1620]</td></tr>
                    <tr><td>DISCOVERY</td><td>File and Directory Discovery [T1083]  </td></tr>
                    <tr><td>Process Discovery [T1057]</td></tr>
                    <tr><td>Software Discovery [T1518]</td></tr>
                    <tr><td>System Information Discovery [T1082]</td></tr>
                    <tr><td>EXECUTION</td><td>Shared Modules [T1129]  </td></tr>
                    <tr><td>PRIVILEGE ESCALATION</td><td>Access Token Manipulation [T1134]</td></tr>



                </tbody>
            </table>
        
            <div class="section-title">MBC Mapping</div>
            <table>
                <tr>
                    <td>MBC Objective</td>
                    <td>MBC Behavior</td>
                </tr>
                <tr>
                    <td>ANTI-BEHAVIORAL ANALYSIS</td>
                    <td>Debugger Detection::Software Breakpoints [B0001.025]</td>
                </tr>
                <tr>
                    <td>ANTI-STATIC ANALYSIS</td>
                    <td>Executable Code Obfuscation::Argument Obfuscation [B0032.020]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Executable Code Obfuscation::Stack Strings [B0032.017]</td>
                </tr>
                <tr>
                    <td>COMMAND AND CONTROL</td>
                    <td>C2 Communication::Receive Data [B0030.002]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>C2 Communication::Send Data [B0030.001]</td>
                </tr>
                <tr>
                    <td>COMMUNICATION</td>
                    <td>HTTP Communication [C0002]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>HTTP Communication::Connect to Server [C0002.009]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>HTTP Communication::Create Request [C0002.012]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>HTTP Communication::Get Response [C0002.017]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>HTTP Communication::Open URL [C0002.004]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>HTTP Communication::Read Header [C0002.014]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>HTTP Communication::Send Request [C0002.003]</td>
                </tr>
                <tr>
                    <td>DATA</td>
                    <td>Check String [C0019]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Compress Data [C0024]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Encode Data::XOR [C0026.002]</td>
                </tr>
                <tr>
                    <td>DEFENSE EVASION</td>
                    <td>Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]</td>
                </tr>
                <tr>
                    <td>DISCOVERY</td>
                    <td>File and Directory Discovery [E1083]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>System Information Discovery [E1082]</td>
                </tr>
                <tr>
                    <td>FILE SYSTEM</td>
                    <td>Create Directory [C0046]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Read File [C0051]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Set File Attributes [C0050]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Write File [C0052]</td>
                </tr>
                <tr>
                    <td>MEMORY</td>
                    <td>Allocate Memory [C0007]</td>
                </tr>
                <tr>
                    <td>PROCESS</td>
                    <td>Check Mutex [C0043]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Create Mutex [C0042]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Create Process [C0017]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Create Process::Create Suspended Process [C0017.003]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Create Thread [C0038]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Enumerate Threads [C0064]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Resume Thread [C0054]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Suspend Thread [C0055]</td>
                </tr>
                <tr>
                    <td></td>
                    <td>Terminate Process [C0018]</td>
                </tr>
            </table>
            <div class="section-title">Capabilities</div>
            <table>
                <thead>
                    <tr>
                        <th>Capability</th>
                        <th>Namespace</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>check for software breakpoints (2 matches)</td>
                        <td>anti-analysis/anti-debugging/debugger-detection</td>
                    </tr>
                    <tr>
                        <td>contain obfuscated stackstrings</td>
                        <td>anti-analysis/obfuscation/string/stackstring</td>
                    </tr>
                    <tr>
                        <td>parse credit card information</td>
                        <td>collection/credit-card</td>
                    </tr>
                    <tr>
                        <td>receive data (2 matches)</td>
                        <td>communication</td>
                    </tr>
                    <tr>
                        <td>send data</td>
                        <td>communication</td>
                    </tr>
                    <tr>
                        <td>get HTTP content length</td>
                        <td>communication/http</td>
                    </tr>
                    <tr>
                        <td>reference HTTP User-Agent string (3 matches)</td>
                        <td>communication/http</td>
                    </tr>
                    <tr>
                        <td>check HTTP status code</td>
                        <td>communication/http/client</td>
                    </tr>
                    <tr>
                        <td>compress data via WinAPI</td>
                        <td>data-manipulation/compression</td>
                    </tr>
                    <tr>
                        <td>encode data using XOR</td>
                        <td>data-manipulation/encoding/xor</td>
                    </tr>
                    <tr>
                        <td>get Program Files directory</td>
                        <td>host-interaction/file-system</td>
                    </tr>
                    <tr>
                        <td>get common file path (3 matches)</td>
                        <td>host-interaction/file-system</td>
                    </tr>
                    <tr>
                        <td>create directory</td>
                        <td>host-interaction/file-system/create</td>
                    </tr>
                    <tr>
                        <td>check if file exists</td>
                        <td>host-interaction/file-system/exists</td>
                    </tr>
                    <tr>
                        <td>get file size</td>
                        <td>host-interaction/file-system/meta</td>
                    </tr>
                    <tr>
                        <td>set file attributes</td>
                        <td>host-interaction/file-system/meta</td>
                    </tr>
                    <tr>
                        <td>read file on Windows</td>
                        <td>host-interaction/file-system/read</td>
                    </tr>
                    <tr>
                        <td>write file on Windows</td>
                        <td>host-interaction/file-system/write</td>
                    </tr>
                    <tr>
                        <td>get disk information</td>
                        <td>host-interaction/hardware/storage</td>
                    </tr>
                    <tr>
                        <td>print debug messages</td>
                        <td>host-interaction/log/debug/write-event</td>
                    </tr>
                    <tr>
                        <td>check mutex</td>
                        <td>host-interaction/mutex</td>
                    </tr>
                    <tr>
                        <td>check mutex and exit</td>
                        <td>host-interaction/mutex</td>
                    </tr>
                    <tr>
                        <td>get system information on Windows (2 matches)</td>
                        <td>host-interaction/os/info</td>
                    </tr>
                    <tr>
                        <td>get process filename</td>
                        <td>host-interaction/process</td>
                    </tr>
                    <tr>
                        <td>create process on Windows</td>
                        <td>host-interaction/process/create</td>
                    </tr>
                    <tr>
                        <td>inject thread</td>
                        <td>host-interaction/process/inject</td>
                    </tr>
                    <tr>
                        <td>use process replacement</td>
                        <td>host-interaction/process/inject</td>
                    </tr>
                    <tr>
                        <td>enumerate processes (2 matches)</td>
                        <td>host-interaction/process/list</td>
                    </tr>
                    <tr>
                        <td>acquire debug privileges</td>
                        <td>host-interaction/process/modify</td>
                    </tr>
                    <tr>
                        <td>modify access privileges</td>
                        <td>host-interaction/process/modify</td>
                    </tr>
                    <tr>
                        <td>enumerate process modules</td>
                        <td>host-interaction/process/modules/list</td>
                    </tr>
                    <tr>
                        <td>terminate process</td>
                        <td>host-interaction/process/terminate</td>
                    </tr>
                    <tr>
                        <td>enumerate threads</td>
                        <td>host-interaction/thread/list</td>
                    </tr>
                    <tr>
                        <td>suspend thread</td>
                        <td>host-interaction/thread/suspend</td>
                    </tr>
                    <tr>
                        <td>access PEB ldr_data</td>
                        <td>linking/runtime-linking</td>
                    </tr>
                    <tr>
                        <td>link function at runtime on Windows (10 matches)</td>
                        <td>linking/runtime-linking</td>
                    </tr>
                    <tr>
                        <td>link many functions at runtime</td>
                        <td>linking/runtime-linking</td>
                    </tr>
                    <tr>
                        <td>resolve function by hash</td>
                        <td>linking/runtime-linking</td>
                    </tr>
                    <tr>
                        <td>linked against CPP standard library</td>
                        <td>linking/static</td>
                    </tr>
                    <tr>
                        <td>linked against CPP regex library</td>
                        <td>linking/static/cppregex</td>
                    </tr>
                    <tr>
                        <td>parse PE header</td>
                        <td>load-code/pe</td>
                    </tr>
                    <tr>
                        <td>resolve function by parsing PE exports (2 matches)</td>
                        <td>load-code/pe</td>
                    </tr>
                    <tr>
                        <td>spawn thread to RWX shellcode</td>
                        <td>load-code/shellcode</td>
                    </tr>
                </tbody>
            </table>
            </div>

            <p>Next, we analyze the file using DetectItEasy. The PE, according to the entropy measurement, is not packed. The bot uses the same building suite of the downloader.</p>
            
            <p>The strings contained in the bot have various references to HTTP fields, and in general it is clear that is capable of building HTTP packets. This time, the IPs used to communicate with C2 are "176.113.115.149" and "185.81.68.156". We see reference to a "/data.php" web page and also some format strings. Additionally, we see a large JSON dictionary with a list of URLs and pieces of injected HTML that is used to steal data from web banking services.  In one of the keys of the JSON "www.exchanger.ws" we see references to four crypto wallets in a piece of inline Javascript code:</p>
            <li>1B4GDAxGV7Vqa9Lav4EfypTxgrAhCFMQrs</li>
            <li>0xb05ee3d0939cb19756a911e16831276263add113</li>
            <li>LYfS7Pc4oqUbFaSEqfAvffWmc7GSM9NBZE</li>
            <li>TVEEyR8HsmMX7vQr5XUAigWLsPquH1jBTW</li>
            <p>
                That, presumably, replace the addresses during a transaction.
            </p>
            <img src="./redlineAnalysis/botStrings1.png" alt="Redline strings analysis" class="gallery-item">
            <img src="./redlineAnalysis/botStrings2.png" alt="Redline strings analysis" class="gallery-item">
            
            <h3>Advanced Static Analysis</h3>
            <p> Having observed its operations in the previous dynamic analysis, we move to the Advanced Static Analysis. The DLL exports one function: DllEntryPoint and ReflectiveLoader. While it is really complicated to reverse engineer code loaded using reflection, a really similar loader was found publicly available on GitHub (<a href= "https://gist.github.com/Niko10/debc459e267201b1ec44c485d2e408b0", target="_blank"> https://gist.github.com/Niko10/debc459e267201b1ec44c485d2e408b0</a>). Luckily, IDA Pro also detects a DllEntryPoint which is presumably the function called by the ReflectiveLoader.</p>
            <p>We move to the DllMain called by the DllEntryPoint. Here we find once again a function that dynamically imports a bunch of functions and defines a set of strings. Interestingly enough, not all of them are used this time so it is possible to assume that more versions of this bot are available or that its functionalities have changed.</p>
            <p>For the following analysis of the code we make us of the pseudocode recunstruction functionality provided by IDA Pro as the code is highly convoluted and complicated by presumably inlined regex functions and text manipulations. We detect the presence of four more crypto wallet addresses:</p>

            <li>1ZWNNwbtBZWS9M9Q58NA2z9e4AXvK9VuD</li>
            <li>0x270a8ee6933ae7a56b82c7c3e625cca5c120a520</li>
            <li>TAfvwf9NS4WXJR8qxTwo5qdnDKTaL762j6</li>
            <li>LKnTdbFRxqoZgx3JaD7fS43urGXp2dgkLU</li>

            <p>Additionally, the thread launching this function collects data from the user clipboard and then sets its content with the manipulated crypto addresses. It is unclear the role of these addresses and of the text copied from the user clipboard for the rest of the code. Presumably, this data is used later in one of the other malicious executables thus achieving modularity.</p>
            <img src="./redlineAnalysis/CryptoWalletsRegex.png" alt="Redline strings analysis" class="gallery-item">

            <p>The next function once again downloads the bot DLL. Then, it copies the local installed browser executable and launches an internal process. While it is unclear what this exactly does, it can be assumed that it is used either to steal data using the JSON shown above or to send the data to the server using the browser's functionalities. Also a pipe is created to communicate with other malicious executables on the system.</p>

            <img src="./redlineAnalysis/DownloadAndUseBrowser.png" alt="Redline strings analysis" class="gallery-item">
            <img src="./redlineAnalysis/UseBrowser.png" alt="Redline strings analysis" class="gallery-item">
            <img src="./redlineAnalysis/pipe.png" alt="Redline strings analysis" class="gallery-item">

            Next, the malware registers the victim to the C2 server using hashed drive and operating system informations. Also, it performs a XOR encoding of the content. After that, the malware receives a list of pipe ('|') separated URLs from the C2 server. The URLs refer to the executables mentioned before. The malware then downloads and executes the executables.

            <img src="./redlineAnalysis/ParseExeList.png" alt="Redline strings analysis" class="gallery-item">
            <img src="./redlineAnalysis/DownloadAndRunExe1.png" alt="Redline strings analysis" class="gallery-item">
            <img src="./redlineAnalysis/DownloadAndRunExe2.png" alt="Redline strings analysis" class="gallery-item">

            <p>We move to another piece of  code convoluted by numerous address manipulations and structures where the malware gets hold of the browser (Chromium-based or Firefox) DLL and access its .text area to obtain a pointer to an unclear function. We can however assume that this is related to sending user data to the C2 server as in one of the functions called in this section we find references to a global variable which contains user data sent to the C2 server with a POST request to the ./data.php URL. The request is created with a format string "report=%s,%s,%d" where the first parameter is "C" if the browser is Chrome, "h" if is Firefox. The second parameter is a global variable that we assume is related to user data, while the third is data stolen using injected HTML from the browser. </p>

            <img src="./redlineAnalysis/ChromiumDlls.png" alt="Redline strings analysis" class="gallery-item">
            <img src="./redlineAnalysis/SendData.png" alt="Redline strings analysis" class="gallery-item">

            <p>We conclude the analysis by focussing on how the malware steals data from the web browser. Previously we mentioned that the malware uses the browser DLL, by manipulating its ".text" area for unclear purposes. While the exact functioning is not clear we can assume that this is done to inject the web content contained in the JSON dictionary mentioned before. In fact, in this section we find references to the fields of that dictionary.</p>
            <img src="./redlineAnalysis/jsonBrowserInjection.png" alt="Redline strings analysis" class="gallery-item">

            <h1>Conclusions</h1>
            <img src="./redlineAnalysis/blog-pyramid-pain-01-768x432.jpg" alt="Redline strings analysis" class="gallery-item">
            <p>In conclusion, this malware is a sophisticated and modular threat, designed to download and execute additional malicious payloads. It can steal sensitive data from the userâ€™s clipboard and web browser, transmitting the stolen information to a command-and-control (C2) server. Additionally, it communicates with other malicious executables on the system, enhancing its functionality. The malware is equipped with advanced evasion techniques, allowing it to detect and hide from analysis tools. It also establishes persistence on the system, ensuring long-term control. Furthermore, it employs techniques like process injection and process hollowing to execute malicious code stealthily. As IoCs, the malware provides both IPs, crypto addreesses, and various strings for mutexes and so on. In any case, most of the IoCs can be considered at most annoying in the Pyramid of Pain [D. J Bianco 2013] so any signature related to these artifacts can easily be modified thus requiring continous maintainance of such signatures by AVs vendors. Additionally, this kind of malware are often sold on the dark-web as MaaS (Malware as a Service), so these kind of IoCs are expected to change from client to client. The best way to counter this malware lies in behavioural protection such as SIGMA rules. In fact, it is more effective to enforce rules for some of the techniques used by the malware such as Process Hollowing, Process Injection, Privileges Excalation, and the use of the browser DLLs.</p>




        
    </div>
        <footer>
            <p>&copy; 2025 Raffaele Carillo. <a href="https://github.com/tuo-username">GitHub</a></p>
        </footer>
    </body>
    </html>
